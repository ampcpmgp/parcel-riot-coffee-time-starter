import riot from 'riot'

<app-root>
  <parts-header></parts-header>
  <h2>{ title }</h2>
  <button type="button" name="button" onClick={ui.addCount}>click me</button>
  <div>
    {ui.clickCount}
  </div>
  <div>
    API: {apiData}
  </div>
  <img src={droidKun} alt="">
  <style type="less">
    :scope {
      display: flex;
      flex-direction: column;
      border: 1px solid;
    }

    > button, > img {
      width: 200px;
    }

    > h2 {
      color: blue;
    }
  </style>
  <script>
    import { observe } from 'dob'
    import axios from 'axios'
    import './parts/header'
    import state from '../state'
    import Path from '../const/path'
    import droidKun from '../images/droid-kun.png'

    this.ui = state.ui
    this.title = 'Hello, World'
    this.droidKun = droidKun
    this.apiData = null

    this.getApi = async () => {
      try {
        const {data} = await axios.get(Path.TEST)
        this.apiData = JSON.stringify(data)
        this.update()
      } catch (e) {
        console.warn('api error')
      }
    }

    this.on('mount', () => {
      const signal = observe(() => {
        this.update()
      })

      this.getApi()

      this.on('unmount', () => {
        signal.unobserve()
      })
    })

  </script>
</app-root>
